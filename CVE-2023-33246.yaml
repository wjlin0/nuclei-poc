id: CVE-2023-33246

info:
  name: CVE-2023-33246
  author: wjlin0
  severity: critical
  description: 对于RocketMQ 5.1.0及以下版本，在某些情况下，存在远程命令执行的风险。RocketMQ的几个组件，包括NameServer、Broker和Controller，在extranet上泄露，并且缺乏权限验证，攻击者可以通过使用更新配置功能作为RocketMQ运行的系统用户执行命令来利用此漏洞。此外，攻击者还可以通过伪造RocketMQ协议内容来达到同样的效果。为了防止这些攻击，建议用户升级到5.1.1或更高版本以使用RocketMQ 5.x，或升级到4.9.6或更高版以使用Rocket MQ 4.x。
  reference:
    - https://www.cvedetails.com/cve/CVE-2023-33246/
  metadata:
    fofa-fork: '"RocketMQ"'
  tags: cve,rocketMQ

network:
  - inputs:
      - data: '000000c7000000c37b22636f6465223a3130352c226578744669656c6473223a7b225369676e6174757265223a222f7535502f775a5562686a616e75344c4d2f557a45646f327532493d222c22746f706963223a22544257313032222c224163636573734b6579223a22726f636b65746d7132227d2c22666c6167223a302c226c616e6775616765223a224a415641222c226f7061717565223a312c2273657269616c697a655479706543757272656e74525043223a224a534f4e222c2276657273696f6e223a3430317d'
        type: hex
    host:
      - "{{Hostname}}"
    read-size: 2048
    extractors:
      - type: regex
        name: version
        group: 1
        internal: true
        regex:
          - '"version":(\d{3})'
    matchers:
      - type: dsl
        dsl:
          - "compare_versions(version, '< 433') && contains(raw,'language\\\":\\\"JAVA\\\"') && contains(raw,'\\\"flag\\\"') && contains(raw,'\\\"serializeTypeCurrentRPC\\\"')"
# digest: 4a0a00473045022100b24b89cd23c4535f7f80fb664d47c032e449ae0d994dce262230b4601e89cb0702203018413a79b322117003014d3c41220a6e98d817538601454379fb08375173fe:9d8cf424f0e932381bf27cf1e926b867